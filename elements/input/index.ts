const CalendarIcon = `<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M6.00004 0.666626V1.99996H10V0.666626H11.3334V1.99996H14C14.3682 1.99996 14.6667 2.29844 14.6667 2.66663V13.3333C14.6667 13.7015 14.3682 14 14 14H2.00004C1.63185 14 1.33337 13.7015 1.33337 13.3333V2.66663C1.33337 2.29844 1.63185 1.99996 2.00004 1.99996H4.66671V0.666626H6.00004ZM13.3334 7.33329H2.66671V12.6666H13.3334V7.33329ZM4.66671 3.33329H2.66671V5.99996H13.3334V3.33329H11.3334V4.66663H10V3.33329H6.00004V4.66663H4.66671V3.33329Z" fill="currentColor"/>
</svg>
`
const PasswordIcon = `<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M12 5.33329H13.3333C13.7015 5.33329 14 5.63177 14 5.99996V14C14 14.3682 13.7015 14.6666 13.3333 14.6666H2.66667C2.29848 14.6666 2 14.3682 2 14V5.99996C2 5.63177 2.29848 5.33329 2.66667 5.33329H4V4.66663C4 2.45749 5.79086 0.666626 8 0.666626C10.2091 0.666626 12 2.45749 12 4.66663V5.33329ZM3.33333 6.66663V13.3333H12.6667V6.66663H3.33333ZM7.33333 9.33329H8.66667V10.6666H7.33333V9.33329ZM4.66667 9.33329H6V10.6666H4.66667V9.33329ZM10 9.33329H11.3333V10.6666H10V9.33329ZM10.6667 5.33329V4.66663C10.6667 3.19387 9.47273 1.99996 8 1.99996C6.52724 1.99996 5.33333 3.19387 5.33333 4.66663V5.33329H10.6667Z" fill="currentColor"/>
</svg>
`

const BlockedIcon = `<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M10.624 1.66736L14.334 5.37734V10.624L10.624 14.334H5.37734L1.66736 10.624V5.37734L5.37734 1.66736H10.624ZM10.0718 3.00069H5.92962L3.00069 5.92962V10.0718L5.92962 13.0007H10.0718L13.0007 10.0718V5.92962L10.0718 3.00069ZM5.33353 7.33351H10.6668V8.66684H5.33353V7.33351Z" fill="currentColor"/>
</svg>
`
const SearchIcon = `<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M12.0207 11.0779L14.8758 13.933L13.933 14.8758L11.0779 12.0207C10.0513 12.842 8.74937 13.3334 7.33337 13.3334C4.02137 13.3334 1.33337 10.6454 1.33337 7.33337C1.33337 4.02137 4.02137 1.33337 7.33337 1.33337C10.6454 1.33337 13.3334 4.02137 13.3334 7.33337C13.3334 8.74937 12.842 10.0513 12.0207 11.0779ZM10.6832 10.5832C11.4984 9.74311 12 8.59711 12 7.33337C12 4.75504 9.91171 2.66671 7.33337 2.66671C4.75504 2.66671 2.66671 4.75504 2.66671 7.33337C2.66671 9.91171 4.75504 12 7.33337 12C8.59711 12 9.74311 11.4984 10.5832 10.6832L10.6832 10.5832Z" fill="currentColor"/>
</svg>
`

const EmailIcon = `<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M2.00004 2H14C14.3682 2 14.6667 2.29848 14.6667 2.66667V13.3333C14.6667 13.7015 14.3682 14 14 14H2.00004C1.63185 14 1.33337 13.7015 1.33337 13.3333V2.66667C1.33337 2.29848 1.63185 2 2.00004 2ZM13.3334 4.82528L8.04791 9.55867L2.66671 4.81063V12.6667H13.3334V4.82528ZM3.00768 3.33333L8.04131 7.77467L13.0007 3.33333H3.00768Z" fill="currentColorColorColorColorColorColorColorColorColorColor"/>
</svg>
`

const TextIcon = `<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M8.66671 3.99996V14H7.33337V3.99996H3.33337V2.66663H12.6667V3.99996H8.66671Z" fill="currentColor"/>
</svg>
`

const LinkIcon = `<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M12.2426 10.357L11.2998 9.41424L12.2426 8.47144C13.5443 7.16971 13.5443 5.05915 12.2426 3.7574C10.9408 2.45565 8.83024 2.45565 7.52851 3.7574L6.5857 4.70021L5.64289 3.7574L6.5857 2.81459C8.40817 0.992142 11.3629 0.992142 13.1854 2.81459C15.0078 4.63704 15.0078 7.59178 13.1854 9.41424L12.2426 10.357ZM10.3569 12.2427L9.41411 13.1855C7.59171 15.0079 4.63691 15.0079 2.81447 13.1855C0.99202 11.363 0.99202 8.40824 2.81447 6.58583L3.75727 5.64302L4.70009 6.58583L3.75727 7.52864C2.45553 8.83038 2.45553 10.9409 3.75727 12.2427C5.05902 13.5444 7.16957 13.5444 8.47131 12.2427L9.41411 11.2998L10.3569 12.2427ZM9.88551 5.17162L10.8284 6.11442L6.1143 10.8284L5.17149 9.88564L9.88551 5.17162Z" fill="currentColor"/>
</svg>
`

const OneIcon = `<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M9.33333 1V14.6667H8V2.46933L5 3.27333V1.89267L8.33333 1H9.33333Z" fill="currentColor"/>
</svg>
`

// HTMLElement 타입 선언
let HTMLElement: typeof globalThis.HTMLElement = globalThis.HTMLElement || class { };

// 브라우저 환경에서 HTMLElement 초기화
if (typeof window !== 'undefined') {
	HTMLElement = window.HTMLElement;
}

import { DefineOnce, passAttributes } from '../util';

import { smallText } from '../typo/style.css';
import {
	inputStyle,
	inputTypeIconStyle,
	inputTypeWrapperStyle,
	wrapperStyle,
} from './style.css';

const DEFAULT_INPUT_TYPE = 'text';

const ICONS_BY_TYPE: Record<string, string> = {
	text: '',
	password: PasswordIcon,
	date: CalendarIcon,
	'datetime-local': CalendarIcon,
	email: EmailIcon,
	number: OneIcon,
	disabled: BlockedIcon,
	search: SearchIcon,
	url: LinkIcon,
};

class IcecreamInput extends HTMLElement {
	static passingProps = [
		'placeholder',
		'type',
		'value',
		'autofocus',
		'disabled',
		'max',
		'min',
		'list',
		'readonly',
		'step',
		'pattern',
		'inputmode',
		'name',
		'required',
	];
	static observedAttributes = IcecreamInput.passingProps;

	input?: HTMLInputElement;

	constructor() {
		super();
	}

	connectedCallback() {
		if (typeof window !== 'undefined') {
			this.input = this.buildInput();
			this.classList.add(wrapperStyle);

			const inputTypeWrapper = this.buildIcon();

			if (this.input) {
				passAttributes(this.input, this, IcecreamInput.passingProps);
			}

			this.appendChild(inputTypeWrapper);

			if (this.getAttribute('autofocus') !== null && this.input) {
				this.input.focus();
			}
		}
	}

	buildInput() {
		if (typeof window !== 'undefined') {
			const input = document.createElement('input');

			input.classList.add(inputStyle, smallText);
			this.appendChild(input);

			return input;
		}
		return null;
	}

	buildIcon() {
		if (typeof window !== 'undefined') {
			const inputTypeWrapper = document.createElement('span');

			const type = this.getIconType();
			const icon = ICONS_BY_TYPE[type] || ICONS_BY_TYPE[DEFAULT_INPUT_TYPE];

			inputTypeWrapper.innerHTML = icon;
			inputTypeWrapper.classList.add(inputTypeWrapperStyle);

			const inputTypeIcon = inputTypeWrapper.firstElementChild;
			if (inputTypeIcon) {
				inputTypeIcon.classList.add(inputTypeIconStyle);
			}

			return inputTypeWrapper;
		}
		return null;
	}

	getIconType() {
		const disabled = this.getAttribute('disabled') !== null;

		if (disabled) {
			return 'disabled';
		}

		return this.getAttribute('type') || DEFAULT_INPUT_TYPE;
	}

	attributeChangedCallback(
		name: string,
		_oldValue: string,
		newValue: string
	) {
		if (
			typeof window !== 'undefined' &&
			this.input &&
			IcecreamInput.passingProps.includes(name)
		) {
			this.input.setAttribute(name, newValue);
		}
	}
}

const name = typeof window !== 'undefined' ? 'ic-input' : () => null;

if (typeof window !== 'undefined') {
	DefineOnce.define(name, IcecreamInput);
}

export default name;
export interface IcecreamInputProps {
	placeholder?: string;
	type?: string;
	value?: string;
	autofocus?: boolean;
	disabled?: boolean;
	max?: string;
	min?: string;
	list?: string;
	readonly?: boolean;
	step?: string;
	pattern?: string;
	inputmode?: string;
	name?: string;
	icon?: string;
	children?: any;
}